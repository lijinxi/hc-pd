Ext.define("Hc_pd.Application",{extend:"Ext.app.Application",name:"Hc_pd",appFolder:"resources/app",init:function(){var a=this;a.setDefaultToken("bltemplate");Ext.setGlyphFontFamily("FontAwesome");Ext.QuickTips.init()},launch:function(){}});
Ext.define("Hc_pd.model.BlTemplate",{extend:"Ext.data.Model",alias:"model.bltemplate",fields:[{name:"id",text:"模板编码",type:"string"},{name:"name",text:"模板名称",type:"string"},],idProperty:"id",identifier:"negative"});
Ext.define("Hc_pd.model.PdProcessDegreeCoef",{extend:"Ext.data.Model",alias:"model.pdprocessdegreecoef",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"workProcessValue",text:"工序价值"},{name:"workProcessCoef",text:"工序系数",type:"float"},{name:"workProcessDegree",text:"工序等级",type:"string"},{name:"enableFlag",text:"启用状态(0=禁用 1=启用)",type:"int",defaultValue:1},{name:"creator",text:"建档人",type:"string"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"修改人",type:"string"},{name:"modifyTime",text:"修改时间"},{name:"remarks",text:"备注",type:"string"}]});
Ext.define("Hc_pd.model.PdWorkGroup",{extend:"Ext.data.Model",alias:"model.pdworkgroup",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"workGroupType",text:"作业组类别",type:"string"},{name:"workGroupCode",text:"作业组编码",type:"string"},{name:"workGroupName",text:"作业组名称",type:"string"},{name:"enableFlag",text:"启用状态(0=禁用 1=启用)",type:"int",defaultValue:1},{name:"description",text:"描述",type:"string"},{name:"creator",text:"建档人",type:"string"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"修改人",type:"string"},{name:"modifyTime",text:"修改时间"},{name:"remarks",text:"备注",type:"string"}]});
Ext.define("Hc_pd.model.PdWorkProcess",{extend:"Ext.data.Model",alias:"model.pdworkprocess",fields:[{name:"processId",text:"工序ID",type:"int"},{name:"workProcessCode",text:"工序编码",type:"string"},{name:"orderNo",text:"排列序号",type:"int"},{name:"workProcessName",text:"工序名称",type:"string"},{name:"workValue",text:"标准工分定额",type:"float"},{name:"workGroupCode",text:"作业组",type:"string"},{name:"isVirtual",text:"是否为虚工序",type:"int"},{name:"parentProcessId",text:"父工序ID",type:"int"},{name:"units",text:"计算单位",type:"int"},{name:"categoryNo",text:"鞋类编号",type:"string"},{name:"categoryName",text:"鞋类名称",type:"string"},{name:"description",text:"描述",type:"string"},{name:"workProcessValue",text:"工序价值",type:"int"},{name:"workCateCode",text:"工序类别编号",type:"string"},{name:"workCateName",text:"工序类别名称",type:"string"},{name:"levelNo",text:"等级",type:"int"},{name:"enableFlag",text:"启用状态(0=禁用 1=启用)",type:"int"},{name:"creator",text:"建档人",type:"string"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"修改人",type:"string"},{name:"modifyTime",text:"修改时间"},{name:"remarks",text:"备注",type:"string"}],idProperty:"processId",identifier:"negative"});
Ext.define("Hc_pd.model.PdWorkProcessCategory",{extend:"Ext.data.Model",alias:"model.pdworkprocesscategory",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"workCateCode",text:"工序类别编码",type:"string"},{name:"workCateName",text:"工序类别名称",type:"string"},{name:"enableFlag",text:"启用状态(0=禁用 1=启用)",type:"int",defaultValue:1},{name:"description",text:"描述",type:"string"},{name:"creator",text:"建档人",type:"string"},{name:"createTime",text:"建档时间"},{name:"modifier",text:"修改人",type:"string"},{name:"modifyTime",text:"修改时间"},{name:"remarks",text:"备注",type:"string"},]});
Ext.define("Hc_pd.model.PdWrkactFaci",{extend:"Ext.data.Model",alias:"model.pdwrkactfaci",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"billNo",text:"单据编号",type:"string"},{name:"wrkactNo",text:"工序工分表编号",type:"string"},{name:"wrkactType",text:"工序工分表类别(取数据字典 workshop_type)",type:"string"},{name:"modelNo",text:"型体",type:"string"},{name:"styleNo",text:"款号",type:"string"},{name:"categoryNo",text:"鞋类(类别编号)",type:"string"},{name:"versionNo",text:"版本号",type:"int"},{name:"isoNo",text:"表号",type:"string"},{name:"billStatus",text:"状态",type:"int"},{name:"creator",text:"创建者",type:"string"},{name:"createTime",text:"创建时间",type:"string"},{name:"modifier",text:"修改者",type:"string"},{name:"modifyTime",text:"修改时间",type:"string"},{name:"auditor",text:"审核人",type:"string"},{name:"auditTime",text:"审核时间",type:"string"},{name:"remarks",text:"备注",type:"string"}]});
Ext.define("Hc_pd.model.PdWrkactFaciDtl",{extend:"Ext.data.Model",alias:"model.pdwrkactfacidtl",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"wrkactNo",text:"工序工分表编号",type:"string"},{name:"workProcessCode",text:"工序编码",type:"string"},{name:"workProcessName",text:"工序名称",type:"string"},{name:"description",text:"工序描述",type:"string"},{name:"workValue",text:"工分值",type:"float"},{name:"orderNo",text:"序号",type:"int"},{name:"workGroupCode",text:"作业组别",type:"string"},{name:"unitNo",text:"单位",type:"string"},{name:"standard",text:"标准工分定额",type:"string"},{name:"funcRelation",text:"函数关系",type:"int"},{name:"aliasName",text:"别名",type:"string"},{name:"toWorkGroupCode",text:"转移作业组别",type:"string"},{name:"remarks",text:"备注",type:"string"},{name:"workProcessValue",text:"工序价值",type:"string"}]});
Ext.define("Hc_pd.model.PdWrkactFaciRel",{extend:"Ext.data.Model",alias:"model.pdwrkactfacirel",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"wrkactNo",text:"工序工分表编号",type:"string"},{name:"materialNo",text:"对应成品编号",type:"string"},{name:"materialName",text:"成品名称",type:"string"},{name:"styleNo",text:"款号",type:"string"},{name:"modelNo",text:"型体",type:"string"}]});
Ext.define("Hc_pd.model.PdWrkactMain",{extend:"Ext.data.Model",alias:"model.pdwrkactmain",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"billNo",text:"单据编号",type:"string"},{name:"wrkactNo",text:"工序工分表编号",type:"string"},{name:"wrkactType",text:"工序工分表类别(取数据字典 workshop_type)",type:"string"},{name:"modelNo",text:"型体",type:"string"},{name:"styleNo",text:"款号",type:"string"},{name:"categoryNo",text:"鞋类(类别编号)",type:"string"},{name:"versionNo",text:"版本号",type:"int"},{name:"isoNo",text:"表号",type:"string"},{name:"billStatus",text:"状态",type:"int"},{name:"creator",text:"创建者",type:"string"},{name:"createTime",text:"创建时间",type:"string"},{name:"modifier",text:"修改者",type:"string"},{name:"modifyTime",text:"修改时间",type:"string"},{name:"auditor",text:"审核人",type:"string"},{name:"auditTime",text:"审核时间",type:"string"},{name:"remarks",text:"备注",type:"string"}]});
Ext.define("Hc_pd.model.PdWrkactMainDtl",{extend:"Ext.data.Model",alias:"model.pdwrkactmaindtl",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"wrkactNo",text:"工序工分表编号",type:"string"},{name:"workProcessCode",text:"工序编码",type:"string"},{name:"workProcessName",text:"工序名称",type:"string"},{name:"description",text:"描述",type:"string"},{name:"workValue",text:"工分值",type:"int"},{name:"orderNo",text:"序号",type:"int"},{name:"workGroupCode",text:"作业组别",type:"string"},{name:"unitNo",text:"单位编号",type:"string"},{name:"standard",text:"标准工分定额",type:"string"},{name:"funcRelation",text:"函数关系",type:"int"},{name:"aliasName",text:"别名",type:"string"}]});
Ext.define("Hc_pd.model.PdWrkactMainRel",{extend:"Ext.data.Model",alias:"model.pdwrkactmainrel",fields:[{name:"lineId",text:"行id(主键)",type:"int"},{name:"wrkactNo",text:"工序工分表编号",type:"string"},{name:"materialNo",text:"对应成品编号",type:"string"},{name:"materialName",text:"对应成品名称",type:"string"},{name:"styleNo",text:"款号",type:"string"},{name:"modelNo",text:"型体",type:"string"},]});
Ext.define("Hc_pd.store.BlTemplate",{extend:"Ext.data.Store",alias:"store.bltemplate",storeId:"bltemplate",model:"Hc_pd.model.BlTemplate"});
Ext.define("Hc_pd.store.WorkGroup",{extend:"Hc_Common.store.NoajaxComBase",alias:"store.WorkGroup",model:"Hc_pd.model.PdWorkGroup",autoLoad:true,proxy:{url:Hc.pdsPath+"pd_work_group/listAll.json"}});
Ext.define("Hc_pd.view.bltemplate.BlTemplate",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.bltemplate",controller:"bltemplate",viewModel:{type:"bltemplate"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"模板名称",name:"name"}],gridModel:"Hc_pd.model.BlTemplate",gridColumns:[{dataIndex:"id",text:"模板编码",editor:{allowBlank:false}},{dataIndex:"name",text:"模板名称",editor:{allowBlank:false}},],gridPrimaryKey:"appNo",gridLoadUrl:Hc.pdsPath+"bl_template/list.json",gridSaveUrl:Hc.pdsPath+"bl_template/batchOperate.json",gridExportUrl:Hc.pdsPath+"bl_template/do_export.json",gridImportUrl:Hc.pdsPath+""});a.callParent()}});
Ext.define("Hc_pd.view.bltemplate.BlTemplateController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.bltemplate"});
Ext.define("Hc_pd.view.bltemplate.BlTemplateModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.bltemplate"});
Ext.define("Hc_pd.view.pdprocessdegreecoef.PdProcessDegreeCoef",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.pdprocessdegreecoef",controller:"pdprocessdegreecoef",viewModel:{type:"pdprocessdegreecoef"},initComponent:function(){var a=this;Ext.apply(a,{gridColumns:[{dataIndex:"workProcessValue",text:"工序价值",maxLength:11,enforceMaxLength:true,editor:{allowBlank:false,regex:/^[0-9]+$/,regexText:"请输入数字"}},{dataIndex:"workProcessCoef",text:"工序系数",maxLength:6,enforceMaxLength:true,editor:{allowBlank:false,regex:/^[0-9]+$/,regexText:"请输入数字"}},{dataIndex:"workProcessDegree",text:"工序等级",maxLength:20,enforceMaxLength:true,editor:{allowBlank:false}},{dataIndex:"enableFlag",text:"启用状态",renderer:"renderUseFlag",editor:{allowBlank:false,xtype:"combouseflag",maxLength:11,enforceMaxLength:true}}],gridModel:"Hc_pd.model.PdProcessDegreeCoef",gridPrimaryKey:"lineId",gridUnionKey:"workProcessValue",gridLoadUrl:Hc.pdsPath+"pd_process_degree_coef/list.json",gridSaveUrl:Hc.pdsPath+"pd_process_degree_coef/batchOperate.json",gridExportUrl:Hc.pdsPath+"pd_process_degree_coef/do_export.json",gridImportUrl:"",searchColumn:4,gridEditModel:"cell",gridCanDrag:false,gridCanEdit:true,gridCanAdd:true,gridCanDelete:true,gridSelModel:"MULTI"});a.callParent()}});
Ext.define("Hc_pd.view.pdprocessdegreecoef.PdProcessDegreeCoefController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.pdprocessdegreecoef"});
Ext.define("Hc_pd.view.pdprocessdegreecoef.PdProcessDegreeCoefModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdprocessdegreecoef"});
Ext.define("Hc_pd.view.pdworkgroup.PdWorkGroup",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.pdworkgroup",controller:"pdworkgroup",viewModel:{type:"pdworkgroup"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"作业组编码",name:"workGroupCode"},{xtype:"textfield",fieldLabel:"作业组名称",name:"workGroupName"}],gridColumns:[{dataIndex:"workGroupCode",text:"作业组编码",maxLength:30,enforceMaxLength:true,editor:{allowBlank:false,regex:/^[0-9a-zA-Z]+$/,regexText:"请输入字母或数字"}},{dataIndex:"workGroupName",text:"作业组名称",maxLength:30,enforceMaxLength:true,editor:{allowBlank:false}},{dataIndex:"workGroupType",text:"作业组类别",maxLength:20,enforceMaxLength:true,editor:{allowBlank:false}},{dataIndex:"enableFlag",text:"启用状态",renderer:"renderUseFlag",editor:{allowBlank:false,xtype:"combouseflag",maxLength:11,enforceMaxLength:true}},{dataIndex:"description",text:"描述",maxLength:100,enforceMaxLength:true,editor:{allowBlank:true}},],gridModel:"Hc_pd.model.PdWorkGroup",gridPrimaryKey:"lineId",gridUnionKey:"workGroupCode",gridLoadUrl:Hc.pdsPath+"pd_work_group/list.json",gridSaveUrl:Hc.pdsPath+"pd_work_group/batchOperate.json",gridExportUrl:Hc.pdsPath+"pd_work_group/do_export.json",gridImportUrl:Hc.pdsPath+"",searchColumn:4,gridEditModel:"cell",gridCanDrag:false,gridCanEdit:true,gridCanAdd:true,gridCanDelete:true,gridSelModel:"MULTI"});a.callParent()}});
Ext.define("Hc_pd.view.pdworkgroup.PdWorkGroupController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.pdworkgroup",onBtnDeleteClick:function(c){var e=this.workObject,b=e.getStore(),d=false,a=e.getSelection();if(a.length<1){return}if(e.isReadOnly){return}if(this.checkDelete(a)===false){return}Ext.Array.each(a,function(g){var h=g.get("_flag");if(h=="A"){b.remove(g)}else{if(e.isCanDelete){var f=g.get("workGroupCode");Ext.Ajax.request({url:Hc.pdsPath+"pd_work_group/checkDelete.json",async:false,params:{workGroupCode:f},success:function(j,k){var i=j.responseText;if(i!=""){Hc.alert(i)}else{g.set("_flag","D");d=true}}})}else{Hc.alert("此网格的数据不能删除");return false}}});if(d){e.view.refresh()}},});
Ext.define("Hc_pd.view.pdworkgroup.PdWorkGroupModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdworkgroup"});
Ext.define("Hc_pd.view.pdworkprocess.PdWorkProcess",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.pdworkprocess",controller:"pdworkprocess",viewModel:{type:"pdworkprocess"},initComponent:function(){var a=this;Ext.apply(a,{gridModel:"Hc_pd.model.PdWorkProcess",gridColumns:[{xtype:"gridcolumn",dataIndex:"processId",text:"工序ID",hidden:true,hideable:false},{xtype:"gridcolumn",dataIndex:"levelNo",text:"等级",hidden:true,hideable:false},{dataIndex:"workGroupCode",text:"作业组",editor:{allowBlank:false},xtype:"bllookupedit",displayvalue:Hc.pdsPath+"pd_work_group/listAll.json",displaymember:"workGroupName",valuemember:"workGroupCode"},{dataIndex:"workCateCode",text:"工序类别编号",editor:{xtype:"searchhelpfield",name:"workCateCode",reference:"workCateCode",gridColumns:[{dataIndex:"workCateCode",text:"类别编号",flex:0.3},{dataIndex:"workCateName",text:"类别名称",flex:0.3},{dataIndex:"enableFlag",text:"启用状态",xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",flex:0.3}],searchItems:[{fieldLabel:"类别编号",name:"workCateCode",flex:0.2},{fieldLabel:"类别名称",name:"workCateName",flex:0.2}],isAutoLoad:false,otherFields:"workCateName",url:Hc.pdsPath+"pd_work_process_category/list.json?enableFlag=1",allowBlank:true,maxLength:30,enforceMaxLength:true}},{dataIndex:"workCateName",text:"工序类别名称"},{dataIndex:"workProcessCode",text:"工序编码"},{dataIndex:"workProcessName",text:"工序名称",editor:{allowBlank:false,maxLength:30,enforceMaxLength:true}},{dataIndex:"orderNo",text:"排列序号",editor:{allowBlank:true,xtype:"numberfield"}},{dataIndex:"workValue",text:"标准工分定额",editor:{allowBlank:false,regex:/^(\+)?\d+(\.\d+)?$/,regexText:"只能输入数字和."}},{dataIndex:"workProcessValue",text:"工序价值",editor:{allowBlank:false},xtype:"bllookupedit",displayvalue:Hc.pdsPath+"pd_process_degree_coef/listAll.json",displaymember:"workProcessValue",valuemember:"workProcessValue"},{dataIndex:"categoryNo",text:"鞋类编号",editor:{xtype:"searchhelpfield",name:"categoryNo",reference:"categoryNo",gridColumns:[{dataIndex:"categoryNo",text:"类别编号",flex:0.3},{dataIndex:"categoryName",text:"类别名称",flex:0.3},{dataIndex:"enableFlag",text:"启用状态",xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",flex:0.3}],searchItems:[{fieldLabel:"类别大类",name:"categoryNo",flex:0.5,xtype:"extcombox",displayvalue:Hc.mdmPath+"bas_category/listCategory.json?type=1",displaymember:"categoryName",valuemember:"categoryNo"}],isAutoLoad:false,otherFields:"categoryName",url:Hc.mdmPath+"bas_category/list.json",allowBlank:true}},{dataIndex:"categoryName",text:"鞋类名称"},{dataIndex:"isVirtual",text:"虚工序",xtype:"bllookupedit",displayvalue:"0=否:1=是"},{xtype:"gridcolumn",dataIndex:"parentProcessId",text:"父工序ID",hidden:true,hideable:false},{dataIndex:"units",text:"计算单位",xtype:"bllookupedit",displayvalue:"0=对:1=其它"},{dataIndex:"enableFlag",text:"启用状态",xtype:"bllookupedit",editor:{allowBlank:false},displayvalue:"0=禁用:1=启用"},{dataIndex:"description",text:"描述",editor:{allowBlank:true,maxLength:100,enforceMaxLength:true}}],gridPrimaryKey:"processId",gridLoadUrl:Hc.pdsPath+"pd_work_process/list.json",gridSaveUrl:Hc.pdsPath+"pd_work_process/batchOperate.json",gridExportUrl:Hc.pdsPath+"pd_work_process/do_export.json",gridImportUrl:"",searchColumn:0,gridEditModel:"cell",gridCanDrag:false,gridCanEdit:true,gridCanAdd:true,gridCanDelete:true,gridSelModel:"SINGLE"});a.otherItems=[{xtype:"treepanel",region:"west",split:true,reference:"menutree",itemId:"menutree",width:300,rootVisible:true,lines:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"workGroupCodeName",text:"基础工序工分",sortable:false,hideable:false}],store:{model:"Hc_pd.model.PdWorkProcess",type:"treebase",proxy:{type:"ajax",url:Hc.pdsPath+"pd_work_process/listAll.json"},root:{id:0,workGroupCodeName:"全部",processId:0,levelNo:0,expanded:false},nodeParam:"processId",parentIdProperty:"parentProcessId"},listeners:{selectionchange:"onTreeSelectionChange",afteritemexpand:"onAfterItemExpand"}}];a.callParent()}});
Ext.define("Hc_pd.view.pdworkprocess.PdWorkProcessController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.pdworkprocess",init:function(){var c=this,b=c.getObjList();if(!b){return}if(!c.workObject&&b.mastergrid){c.workObject=b.mastergrid}c.callParent(arguments);b.btnSearch.setVisible(false);b.btnReset.setVisible(false);b.btnCopy.setVisible(false);b.btnEdit.setVisible(false);b.btnOther1.setVisible(true);b.btnOther1.setText("刷新树");b.btnOther1.setGlyph(Hc.Icon.btnRefresh);var a=c.lookupReference("menutree");a.getSelectionModel().select(a.getRootNode())},onRefreshTree:function(){var d=this;var b=d.lookupReference("menutree");var a=b.store;a.proxy.extraParams.processId=0;a.load();delete a.proxy.extraParams.processId;var e=d.getObjList();var c=e.mastergrid.store;delete c.proxy.extraParams.processId;c.proxy.extraParams.processId=0;c.load()},onTreeSelectionChange:function(e,a){var b=this,d=b.getObjList();if(!d){return}store=d.mastergrid.store,selLength=e.selected.items.length;if(selLength==1){var c=e.selected.items[0].data.processId;store.proxy.extraParams.processId=c}else{}store.reload();if(this.canDelete()&&d.btnDelete){d.btnDelete.setDisabled(a.length===0)}if(this.canPrint()&&d.btnPrint){d.btnPrint.setDisabled(a.length===0)}},onAfterItemExpand:function(f,b,e,d){var c=this,a=c.lookupReference("menutree");a.getSelectionModel().select(f)},initAddData:function(b){var d=this,a=d.lookupReference("menutree");if(!a.selection){Hc.alert("请先选择一个树节点再增加！");return false}var e=a.selection.data.processId,c=a.selection.data.levelNo;workGroupCode=a.selection.data.workGroupCode,workCateCode=a.selection.data.workCateCode,workCateName=a.selection.data.workCateName;b.data.parentProcessId=e;b.data.enableFlag=1;b.data.levelNo=c+1;b.data.workGroupCode=workGroupCode;b.data.workCateCode=workCateCode;b.data.workCateName=workCateName},onBtnDeleteClick:function(c){var e=this.workObject,b=e.getStore(),d=false,a=e.getSelection();if(a.length<1){return}if(e.isReadOnly){return}if(this.checkDelete(a)===false){return}Ext.Array.each(a,function(f){var h=f.get("_flag");if(h=="A"){b.remove(f)}else{if(e.isCanDelete){var g=f.get("processId");Ext.Ajax.request({url:Hc.pdsPath+"pd_work_process/checkDelete.json",async:false,params:{processId:g},success:function(k,l){var i=k.responseText;if(i!=""){Hc.alert(i)}else{f.set("_flag","D");d=true}}})}else{Hc.alert("此网格的数据不能删除");return false}}});if(d){e.view.refresh()}},afterSave:function(k,i){var f=this;f.callParent(arguments);var b=f.getObjList();if(!b){return}var l=f.lookupReference("menutree"),d=l.store,e=b.mastergrid.store;var c=l.selection;if(!c){return}var a=0;var g=c.childNodes;for(j=0;j<g.length;j++){var h=g[j];if(h.data.expanded==true){a=1;break}}if(a===1){f.onRefreshTree()}else{d.reload()}},onBtnOther1:function(a){this.onRefreshTree()}});
Ext.define("Hc_pd.view.pdworkprocess.PdWorkProcessModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdworkprocess"});
Ext.define("Hc_pd.view.pdworkprocesscategory.PdWorkProcessCategory",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.pdworkprocesscategory",controller:"pdworkprocesscategory",viewModel:{type:"pdworkprocesscategory"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"工序类别编码",name:"workCateCode"},{xtype:"textfield",fieldLabel:"工序类别名称",name:"workCateName"}],gridModel:"Hc_pd.model.PdWorkProcessCategory",gridColumns:[{dataIndex:"workCateCode",text:"工序类别编码",editor:{allowBlank:false,regex:/^[0-9a-zA-Z]+$/,regexText:"请输入字母或数字"}},{dataIndex:"workCateName",text:"工序类别名称",editor:{allowBlank:false}},{dataIndex:"enableFlag",text:"启用状态",renderer:"renderUseFlag",editor:{allowBlank:false,xtype:"combouseflag",maxLength:30,enforceMaxLength:true}},{dataIndex:"description",text:"描述",editor:{allowBlank:true}}],gridPrimaryKey:"lineId",gridUnionKey:"workCateCode",gridLoadUrl:Hc.pdsPath+"pd_work_process_category/list.json",gridSaveUrl:Hc.pdsPath+"pd_work_process_category/batchOperate.json",gridExportUrl:Hc.pdsPath+"pd_work_process_category/do_export.json",gridImportUrl:Hc.pdsPath+""});a.callParent()}});
Ext.define("Hc_pd.view.pdworkprocesscategory.PdWorkProcessCategoryController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.pdworkprocesscategory",onBtnDeleteClick:function(c){var e=this.workObject,b=e.getStore(),d=false,a=e.getSelection();if(a.length<1){return}if(e.isReadOnly){return}if(this.checkDelete(a)===false){return}Ext.Array.each(a,function(f){var h=f.get("_flag");if(h=="A"){b.remove(f)}else{if(e.isCanDelete){var g=f.get("workCateCode");Ext.Ajax.request({url:Hc.pdsPath+"pd_work_process_category/checkDelete.json",async:false,params:{workCateCode:g},success:function(j,k){var i=j.responseText;if(i!=""){Hc.alert(i)}else{f.set("_flag","D");d=true}}})}else{Hc.alert("此网格的数据不能删除");return false}}});if(d){e.view.refresh()}},});
Ext.define("Hc_pd.view.pdworkprocesscategory.PdWorkProcessCategoryModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdworkprocesscategory"});
Ext.define("Hc_pd.view.pdworkprocesschoose.PdWorkProcessChoose",{extend:"Hc_Common.view.BaseMultiPage",alias:"widget.pdworkprocesschoose",controller:"pdworkprocesschoose",viewModel:{type:"pdworkprocesschoose"},isAutoLoad:false,customLayout1:true,choosetoolbar:{xtype:"toolbar",reference:"choosetoolbar",region:"north",items:[{text:"添加",itemId:"btnAddProcess",reference:"btnAddProcess",handler:"onBtnAddProcessClick",glyph:Hc.Icon.btnAdd,canUse:true,disabled:false},{text:"移除",itemId:"btnRemoveProcess",reference:"btnRemoveProcess",handler:"onBtnRemoveProcessClick",glyph:Hc.Icon.btnDelete,canUse:true,disabled:false}]},initComponent:function(){var e=this;Ext.apply(e,{searchItems:[{xtype:"textfield",fieldLabel:"工序编码",name:"workProcessCode"},{xtype:"textfield",fieldLabel:"工序名称",name:"workProcessName"}],gridModel:"Hc_pd.model.PdWorkProcess",gridColumns:[{xtype:"gridcolumn",dataIndex:"processId",text:"工序ID",hidden:true,hideable:false},{xtype:"gridcolumn",dataIndex:"levelNo",text:"等级",hidden:true,hideable:false},{dataIndex:"workGroupCode",text:"作业组",xtype:"bllookupedit",displayvalue:Hc.pdsPath+"pd_work_group/listAll.json",displaymember:"workGroupName",valuemember:"workGroupCode",readOnly:true},{dataIndex:"workCateCode",text:"工序类别编号"},{dataIndex:"workCateName",text:"工序类别名称"},{dataIndex:"workProcessCode",text:"工序编码"},{dataIndex:"workProcessName",text:"工序名称"},{dataIndex:"orderNo",text:"排列序号",editor:{allowBlank:true,xtype:"numberfield"}},{dataIndex:"workValue",text:"标准工分定额"},{dataIndex:"workProcessValue",text:"工序价值",xtype:"bllookupedit",displayvalue:Hc.pdsPath+"pd_process_degree_coef/listAll.json",displaymember:"workProcessValue",valuemember:"workProcessValue",readOnly:true},{dataIndex:"categoryNo",text:"鞋类编号"},{dataIndex:"categoryName",text:"鞋类名称"},{dataIndex:"isVirtual",text:"虚工序",xtype:"bllookupedit",displayvalue:"0=否:1=是"},{xtype:"gridcolumn",dataIndex:"parentProcessId",text:"父工序ID",hidden:true,hideable:false},{dataIndex:"units",text:"计算单位",xtype:"bllookupedit",displayvalue:"0=对:1=其它"},{dataIndex:"enableFlag",text:"启用状态",xtype:"bllookupedit",editor:{allowBlank:false},displayvalue:"0=禁用:1=启用"},{dataIndex:"description",text:"描述",editor:{allowBlank:true,maxLength:100,enforceMaxLength:true}}],gridPrimaryKey:"processId",gridLoadUrl:Hc.pdsPath+"pd_work_process/list.json",gridEditModel:"cell",gridCanDrag:false,gridCanEdit:true,gridCanAdd:false,gridCanDelete:false,gridSelModel:"SINGLE",grid1Model:"Hc_pd.model.PdWorkProcess",grid1Columns:[{xtype:"gridcolumn",dataIndex:"processId",text:"工序ID",hidden:true,hideable:false},{xtype:"gridcolumn",dataIndex:"levelNo",text:"等级",hidden:true,hideable:false},{dataIndex:"workGroupCode",text:"作业组",xtype:"bllookupedit",displayvalue:Hc.pdsPath+"pd_work_group/listAll.json",displaymember:"workGroupName",valuemember:"workGroupCode",readOnly:true},{dataIndex:"workCateCode",text:"工序类别编号"},{dataIndex:"workCateName",text:"工序类别名称"},{dataIndex:"workProcessCode",text:"工序编码"},{dataIndex:"workProcessName",text:"工序名称"},{dataIndex:"orderNo",text:"排列序号",editor:{allowBlank:true,xtype:"numberfield"},hidden:true},{dataIndex:"workValue",text:"标准工分定额"},{dataIndex:"workProcessValue",text:"工序价值",xtype:"bllookupedit",displayvalue:Hc.pdsPath+"pd_process_degree_coef/listAll.json",displaymember:"workProcessValue",valuemember:"workProcessValue",readOnly:true},{dataIndex:"categoryNo",text:"鞋类编号"},{dataIndex:"categoryName",text:"鞋类名称"},{dataIndex:"isVirtual",text:"虚工序",xtype:"bllookupedit",displayvalue:"0=否:1=是",readOnly:true},{xtype:"gridcolumn",dataIndex:"parentProcessId",text:"父工序ID",hidden:true,hideable:false},{dataIndex:"units",text:"计算单位",xtype:"bllookupedit",displayvalue:"0=对:1=其它",readOnly:true},{dataIndex:"enableFlag",text:"启用状态",xtype:"bllookupedit",displayvalue:"0=禁用:1=启用",readOnly:true},{dataIndex:"description",text:"描述"}],grid1PrimaryKey:"processId",grid1LoadUrl:Hc.pdsPath+"pd_work_process/list.json",grid1EditModel:"cell",grid1CanDrag:false,grid1CanEdit:true,grid1CanAdd:true,grid1CanDelete:true,grid1SelModel:"SINGLE"});Ext.apply(e.grid,{id:"workProcessChooseGrid"});Ext.apply(e.grid1,{id:"workProcessChooseGrid1"});treepanel={xtype:"treepanel",region:"west",split:true,reference:"menutree",itemId:"menutree",width:300,rootVisible:true,lines:true,columns:[{xtype:"treecolumn",flex:1,dataIndex:"workGroupCodeName",text:"基础工序工分",sortable:false,hideable:false}],store:{model:"Hc_pd.model.PdWorkProcess",type:"treebase",proxy:{type:"ajax",url:Hc.pdsPath+"pd_work_process/listAll.json"},root:{id:0,workGroupCodeName:"全部",processId:0,levelNo:0,expanded:false},nodeParam:"processId",parentIdProperty:"parentProcessId"},listeners:{selectionchange:"onTreeSelectionChange",afteritemexpand:"onAfterItemExpand"}};e.items=[e.toolbar];if(e.searchItems.length>0){e.items.push(e.searchPanel)}var d=e.controller.getBodyHeight(0.4);var c={xtype:"panel",height:d,region:"north",layout:"border",items:[e.grid],split:true,border:false};d=e.controller.getBodyHeight(0.04);var a={xtype:"panel",height:d,region:"north",layout:"border",items:[e.choosetoolbar],border:false};var i={xtype:"panel",region:"center",layout:"border",items:[e.grid1],border:false};var f={xtype:"panel",region:"center",layout:"border",items:[a,i],border:false};var g={xtype:"panel",region:"center",layout:"border",items:[c,f],border:false};var b={xtype:"panel",region:"center",layout:"border",items:[treepanel,g],border:false};e.items.push(b);e.callParent()}});
Ext.define("Hc_pd.view.pdworkprocesschoose.PdWorkProcessChooseController",{extend:"Hc_pd.view.pdworkprocess.PdWorkProcessController",alias:"controller.pdworkprocesschoose",init:function(){var e=this;e.callParent(arguments);var b=e.lookupReference("commontoolbar").items;for(var c=0;c<b.length;c++){var d=b.getAt(c);d.setVisible(d.itemId=="btnSearch"||d.itemId=="btnOther1");if(d.itemId=="btnOther1"){d.setText("刷新树");d.setGlyph(Hc.Icon.btnRefresh)}}e.getObj("grid1").down("pagingtoolbar").setVisible(false);var a=e.lookupReference("menutree");a.getSelectionModel().select(a.getRootNode())},onBtnAddProcessClick:function(a){this.onBtnAddClick(null)},onBtnRemoveProcessClick:function(a){this.onBtnDeleteClick(null)},onBtnAddClick:function(b){var c=this,a=c.getObjList();c.workObject=a.grid1;c.callParent(arguments)},onBtnDeleteClick:function(b){var c=this,a=c.getObjList();c.workObject=a.grid1;c.callParent(arguments)},initAddData:function(a){var d=this,b=d.getObjList();var c=b.mastergrid.getSelection()[0];if(!c){Hc.alert("请先选择工序");return false}a.set("levelNo",c.get("levelNo"));a.set("workGroupCode",c.get("workGroupCode"));a.set("workCateCode",c.get("workCateCode"));a.set("workCateName",c.get("workCateName"));a.set("workProcessCode",c.get("workProcessCode"));a.set("workProcessName",c.get("workProcessName"));a.set("orderNo",c.get("orderNo"));a.set("workValue",c.get("workValue"));a.set("workProcessValue",c.get("workProcessValue"));a.set("categoryNo",c.get("categoryNo"));a.set("categoryName",c.get("categoryName"));a.set("isVirtual",c.get("isVirtual"));a.set("parentProcessId",c.get("parentProcessId"));a.set("units",c.get("units"));a.set("enableFlag",c.get("enableFlag"));a.set("description",c.get("description"))},onBtnSearchClick:function(d){var e=this;var b=e.lookupReference("menutree");var a=b.store;delete a.proxy.extraParams.processId;delete a.proxy.extraParams.workProcessCode;delete a.proxy.extraParams.workProcessName;var f=e.getObjList();var c=f.mastergrid.store;delete c.proxy.extraParams.processId;delete c.proxy.extraParams.workProcessCode;delete c.proxy.extraParams.workProcessName;e.callParent(arguments)}});
Ext.define("Hc_pd.view.pdworkprocesschoose.PdWorkProcessChooseModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdworkprocesschoose"});
Ext.define("Hc_pd.view.pdwrkactfaci.PdWrkactFaci",{extend:"Hc_Common.view.BaseBillListPage",alias:"widget.pdwrkactfaci",controller:"pdwrkactfaci",viewModel:{type:"pdwrkactfaci"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"款号",name:"styleNo",maxLength:20,enforceMaxLength:true},{xtype:"textfield",fieldLabel:"型体",name:"modelNo",maxLength:20,enforceMaxLength:true},{xtype:"textfield",fieldLabel:"鞋类",name:"categoryNo",maxLength:20,enforceMaxLength:true},{xtype:"extcombox",fieldLabel:"工分表类别",name:"wrkactType",maxLength:20,displayvalue:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=workshop_type",displaymember:"itemName",valuemember:"itemCode",enforceMaxLength:true}],gridColumns:[{dataIndex:"wrkactNo",text:"工序工分表编号",width:150,hidden:true},{dataIndex:"wrkactType",text:"工分表类别",xtype:"bllookupedit",displayvalue:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=workshop_type",displaymember:"itemName",valuemember:"itemCode"},{dataIndex:"modelNo",text:"型体"},{dataIndex:"styleNo",text:"款号"},{dataIndex:"categoryNo",text:"鞋类"},{dataIndex:"versionNo",text:"版本号"},{dataIndex:"isoNo",text:"表号"},{dataIndex:"modifier",text:"修改人"},{dataIndex:"modifyTime",text:"修改时间",width:200},],billStatusUrl:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=pd_bill_status",gridModel:"Hc_pd.model.PdWrkactFaci",gridLoadUrl:Hc.pdsPath+"pd_wrkact_faci/list.json",dtlName:"pdwrkactfacidtl",gridHasMark:false,gridHasCreator:false,gridHasModifier:false,gridHasAuditor:false,gridHasBillNo:false,showModel:"selftab",billStatusText:"工分表状态",billNoText:"工分表编号"});a.callParent()}});
Ext.define("Hc_pd.view.pdwrkactfaci.PdWrkactFaciController",{extend:"Hc_Common.view.BaseBillListPageController",alias:"controller.pdwrkactfaci",init:function(){var b=this,a=b.getObjList();b.callParent();a.btnAdd.setVisible(false)},});
Ext.define("Hc_pd.view.pdwrkactfaci.PdWrkactFaciModel",{extend:"Hc_Common.view.BaseBillListPageModel",alias:"viewmodel.pdwrkactfaci"});
Ext.define("Hc_pd.view.pdwrkactfacidtl.PdWrkactFaciDtl",{extend:"Hc_Common.view.BaseBillDetailPage",alias:"widget.pdwrkactfacidtl",controller:"pdwrkactfacidtl",viewModel:{type:"pdwrkactfacidtl"},initComponent:function(){var b=this;var a=Ext.create("Hc_pd.store.WorkGroup");Ext.apply(b,{billItems:[{name:"wrkactType",reference:"wrkactType",allowBlank:true,bind:{value:"{billRow.wrkactType}"},fieldLabel:"工分表类别",xtype:"extcombox",displayvalue:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=workshop_type",displaymember:"itemName",valuemember:"itemCode",canInput:false},{name:"styleNo",allowBlank:true,bind:{value:"{billRow.styleNo}"},fieldLabel:"款号",xtype:"textfield",canInput:false},{name:"modelNo",allowBlank:true,bind:{value:"{billRow.modelNo}"},fieldLabel:"型体",xtype:"textfield",canInput:false},{name:"categoryNo",allowBlank:true,bind:{value:"{billRow.categoryNo}"},fieldLabel:"鞋类",xtype:"textfield",canInput:false},{name:"versionNo",allowBlank:true,bind:{value:"{billRow.versionNo}"},fieldLabel:"版本号",xtype:"textfield",canInput:false}],billLoadUrl:Hc.pdsPath+"pd_wrkact_faci/list.json",billSaveUrl:Hc.pdsPath+"pd_wrkact_faci/saveMasterCustomerList.json",billAuditUrl:Hc.pdsPath+"pd_wrkact_faci/audit.json",billExportUrl:Hc.pdsPath+"pd_wrkact_faci/do_export.json",billModel:"Hc_pd.model.PdWrkactFaci",billSubGrid:["mastergrid","grid1"],billType:"WrkactMain",gridColumns:[{dataIndex:"workProcessCode",text:"工序编码"},{dataIndex:"workGroupCode",xtype:"bllookupedit",estore:a,gstore:a,displaymember:"workGroupName",valuemember:"workGroupCode",text:"作业组别",editor:{allowBlank:false}},{dataIndex:"workProcessName",text:"工序名称"},{dataIndex:"toWorkGroupCode",text:"转移作业组别",xtype:"bllookupedit",estore:a,gstore:a,displaymember:"workGroupName",valuemember:"workGroupCode",editor:{allowBlank:true}},{dataIndex:"aliasName",text:"工序别名"},{dataIndex:"standard",text:"标准工分定额"},{dataIndex:"unitNo",text:"计算单位"},{dataIndex:"funcRelation",text:"函数关系"},{dataIndex:"workValue",text:"工分值"},{dataIndex:"workProcessValue",text:"工序价值"},{dataIndex:"categoryNo",text:"鞋类"},{dataIndex:"description",text:"工序描述"},{dataIndex:"remarks",text:"备注"}],gridTitle:"工序工分",gridPrimaryKey:"lineId",gridModel:"Hc_pd.model.PdWrkactFaciDtl",gridLoadUrl:Hc.pdsPath+"pd_wrkact_faci_dtl/listAll.json",grid1Columns:[{dataIndex:"lineId",text:"行id(主键)",editor:{allowBlank:false},hidden:true},{dataIndex:"wrkactNo",text:"工序工分表编号",editor:{allowBlank:false},hidden:true},{dataIndex:"materialNo",text:"对应成品编号"},{dataIndex:"materialName",text:"对应成品名称"},{dataIndex:"styleNo",text:"款号"},{dataIndex:"modelNo",text:"型体"}],grid1HasOrderNo:false,grid1Title:"对应产品",grid1PrimaryKey:"lineId",grid1Model:"Hc_pd.model.PdWrkactFaciRel",grid1LoadUrl:Hc.pdsPath+"pd_wrkact_faci_rel/listAll.json",grid1SaveUrl:Hc.pdsPath+"pd_wrkact_faci_rel/batchOperate.json"});b.callParent()}});
Ext.define("Hc_pd.view.pdwrkactfacidtl.PdWrkactFaciDtlController",{extend:"Hc_pd.view.pdwrkactmaindtl.PdWrkactMainDtlController",alias:"controller.pdwrkactfacidtl",oldWorkProcessCode:"",oldMaterialNo:"",init:function(){var f=this;f.callParent();var c=f.lookupReference("billtoolbar").items;for(var b=0;b<c.length;b++){var d=c.getAt(b);d.setVisible(d.itemId=="btnBillPrev"||d.itemId=="btnBillNext"||d.itemId=="btnBillSave"||d.itemId=="btnBillAudit"||d.itemId=="btnBillBack")}var a=f.lookupReference("commontoolbar").items;for(var b=0;b<a.length;b++){var e=a.getAt(b);e.setVisible(e.itemId=="btnOther1"||e.itemId=="btnOther2"||e.itemId=="btnCancel")}},setStatusText:function(c){var d=this,a=d.getObjList();d.callParent(arguments);var b=c.get("billStatus");if(b===5){a.btnBillAudit.setText("释放");a.btnBillAudit.setDisabled(false)}else{if(b===45){a.btnBillAudit.setText("取消释放");a.btnBillAudit.setDisabled(false)}else{if(b===50){a.btnBillAudit.setText("待引用");a.btnBillAudit.setDisabled(true)}else{a.btnBillAudit.setText("已引用");a.btnBillAudit.setDisabled(true)}}}},onBtnBillPrevClick:function(a){var b=this;b.getWorkGroupStore();b.callParent(arguments)},onBtnBillNextClick:function(a){var b=this;b.getWorkGroupStore();b.callParent(arguments)},getWorkGroupStore:function(){var b=this,c=b.getObjList();var a=b.getObjList().mastergrid.columns;Ext.each(a,function(e){if(e.dataIndex==="workGroupCode"||e.dataIndex==="toWorkGroupCode"){var d=e.getEditor().store;delete d.proxy.extraParams.workGroupType;d.load()}})},onGridBeforeEdit:function(b,f){if(this.gridCannotEditKeyField(f)===false){return false}if(f.field=="toWorkGroupCode"||f.field=="workGroupCode"){var h=this,d=f.record,a=h.getObjList(),i=f.column.getEditor().store;var g=h.lookupReference("wrkactType").getValue();var c=i.proxy.extraParams.workGroupType;if(g!=c){var j=d.get(f.field);i.proxy.extraParams.workGroupType=g;i.on("load",function(){f.column.getEditor().setValue(j)});i.load()}}}});
Ext.define("Hc_pd.view.pdwrkactfacidtl.PdWrkactFaciDtlModel",{extend:"Hc_Common.view.BaseBillDetailPageModel",alias:"viewmodel.pdwrkactfacidtl"});
Ext.define("Hc_pd.view.pdwrkactfacirel.PdWrkactFaciRel",{extend:"Hc_Common.view.BaseBillDetailPage",alias:"widget.pdwrkactfacirel",controller:"pdwrkactfacirel",viewModel:{type:"pdwrkactfacirel"},initComponent:function(){var a=this;Ext.apply(a,{gridColumns:[{dataIndex:"lineId",text:"行id(主键)",editor:{allowBlank:false}},{dataIndex:"wrkactNo",text:"工序工分表编号",editor:{allowBlank:false}},{dataIndex:"materialNo",text:"对应成品编号",editor:{allowBlank:false}},],gridPrimaryKey:"lineId",gridModel:"Hc_pd.model.PdWrkactFaciRel",gridLoadUrl:Hc.pdsPath+"pd_wrkact_faci_rel/list.json"});a.callParent()}});
Ext.define("Hc_pd.view.pdwrkactfacirel.PdWrkactFaciRelController",{extend:"Hc_Common.view.BaseBillDetailPageController",alias:"controller.pdwrkactfacirel"});
Ext.define("Hc_pd.view.pdwrkactfacirel.PdWrkactFaciRelModel",{extend:"Hc_Common.view.BaseBillDetailPageModel",alias:"viewmodel.pdwrkactfacirel"});
Ext.define("Hc_pd.view.pdwrkactmain.PdWrkactMain",{extend:"Hc_Common.view.BaseBillListPage",alias:"widget.pdwrkactmain",controller:"pdwrkactmain",viewModel:{type:"pdwrkactmain"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"款号",name:"styleNo"},{xtype:"textfield",fieldLabel:"型体",name:"modelNo"},{xtype:"textfield",fieldLabel:"鞋类",name:"categoryNo"},{xtype:"extcombox",fieldLabel:"工分表类别",name:"wrkactType",displayvalue:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=workshop_type",displaymember:"itemName",valuemember:"itemCode"},],gridColumns:[{dataIndex:"lineId",text:"行id(主键)",editor:{allowBlank:false},hidden:true},{dataIndex:"wrkactNo",text:"工序工分表编号",width:140,hidden:true},{dataIndex:"wrkactType",text:"工分表类别",xtype:"bllookupedit",displayvalue:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=workshop_type",displaymember:"itemName",valuemember:"itemCode"},{dataIndex:"modelNo",text:"型体"},{dataIndex:"styleNo",text:"款号"},{dataIndex:"categoryNo",text:"鞋类"},{dataIndex:"versionNo",text:"版本号"},{dataIndex:"isoNo",text:"表号"},{dataIndex:"billStatus",text:"状态",hidden:true},{dataIndex:"creator",text:"创建者"},{dataIndex:"createTime",text:"创建时间"},{dataIndex:"modifier",text:"修改者"},{dataIndex:"modifyTime",text:"修改时间"},{dataIndex:"auditor",text:"审核人"},{dataIndex:"auditTime",text:"审核时间"},{dataIndex:"billStatusName",text:"工分表状态"},{dataIndex:"remarks",text:"备注"},],gridModel:"Hc_pd.model.PdWrkactMain",gridLoadUrl:Hc.pdsPath+"pd_wrkact_main/list.json",billStatusUrl:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=pd_bill_status",dtlName:"pdwrkactmaindtl",gridHasMark:false,gridHasCreator:false,gridHasModifier:false,gridHasAuditor:false,gridHasBillNo:false,showModel:"selftab",billStatusText:"工分表状态",billNoText:"工分表编号"});a.callParent()}});
Ext.define("Hc_pd.view.pdwrkactmain.PdWrkactMainController",{extend:"Hc_Common.view.BaseBillListPageController",alias:"controller.pdwrkactmain",init:function(){var c=this;c.callParent(arguments);var b=c.getObjList().mastergrid;var a=b.columns;Ext.Array.each(a,function(d){if(d.dataIndex=="billNo"){d.text="工分表编号"}if(d.dataIndex=="billStatus"){d.text="工分表状态"}})}});
Ext.define("Hc_pd.view.pdwrkactmain.PdWrkactMainModel",{extend:"Hc_Common.view.BaseBillListPageModel",alias:"viewmodel.pdwrkactmain"});
Ext.define("Hc_pd.view.pdwrkactmaindialog.PdWrkactMainDialog",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.pdwrkactmaindialog",controller:"pdwrkactmaindialog",viewModel:{type:"pdwrkactmaindialog"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"款号",name:"styleNo"},{xtype:"textfield",fieldLabel:"型体",name:"modelNo"},{xtype:"textfield",fieldLabel:"鞋类",name:"categoryNo"}],gridColumns:[{dataIndex:"billNo",text:"单据编号"},{dataIndex:"wrkactNo",text:"工序工分表编号"},{dataIndex:"wrkactType",text:"工序工分表类别"},{dataIndex:"modelNo",text:"型体"},{dataIndex:"styleNo",text:"款号"},{dataIndex:"categoryNo",text:"鞋类(类别编号)"},{dataIndex:"versionNo",text:"版本号"}],gridModel:"Hc_pd.model.PdWrkactMain",gridLoadUrl:Hc.pdsPath+"pd_wrkact_main/list.json",showModel:"selftab"});Ext.apply(a.grid,{id:"PdWrkactMainDialogGrid"});a.callParent()}});
Ext.define("Hc_pd.view.pdwrkactmaindialog.PdWrkactMainDialogController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.pdwrkactmaindialog",init:function(){var d=this;d.callParent();var a=d.lookupReference("commontoolbar").items;for(var b=0;b<a.length;b++){var c=a.getAt(b);c.setVisible(c.itemId=="btnSearch")}}});
Ext.define("Hc_pd.view.pdwrkactmaindialog.PdWrkactMainDialogModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdwrkactmaindialog"});
Ext.define("Hc_pd.view.pdwrkactmaindtl.PdWrkactMainDtl",{extend:"Hc_Common.view.BaseBillDetailPage",alias:"widget.pdwrkactmaindtl",controller:"pdwrkactmaindtl",viewModel:{type:"pdwrkactmaindtl"},initComponent:function(){var b=this;var a=Ext.create("Hc_pd.store.WorkGroup");Ext.apply(b,{billType:"WrkactMain",billItems:[{xtype:"extcombox",fieldLabel:"工分表类别",name:"wrkactType",displayvalue:Hc.mdmPath+"bas_dict/getbasdictcombo.json?dictCode=workshop_type",displaymember:"itemName",valuemember:"itemCode",reference:"wrkactType",allowBlank:false,bind:{value:"{billRow.wrkactType}"}},{xtype:"textfield",fieldLabel:"款号",name:"styleNo",reference:"styleNo",bind:{value:"{billRow.styleNo}"}},{xtype:"textfield",fieldLabel:"鞋类",name:"categoryNo",reference:"categoryNo",allowBlank:false,bind:{value:"{billRow.categoryNo}"}},{xtype:"textfield",fieldLabel:"版本",name:"versionNo",reference:"versionNo",bind:{value:"{billRow.versionNo}"}},{xtype:"textfield",fieldLabel:"型体",name:"modelNo",reference:"modelNo",bind:{value:"{billRow.modelNo}"}}],billLoadUrl:Hc.pdsPath+"pd_wrkact_main/list.json",billSaveUrl:Hc.pdsPath+"pd_wrkact_main/saveMasterCustomerList.json",billAuditUrl:Hc.pdsPath+"pd_wrkact_main/audit.json",billExportUrl:Hc.pdsPath+"pd_wrkact_main/do_export.json",billModel:"Hc_pd.model.PdWrkactMain",billSubGrid:["mastergrid","grid1"],gridUnionKey:"wrkactNo",gridColumns:[{dataIndex:"lineId",text:"行id(主键)",editor:{allowBlank:false},hidden:true},{dataIndex:"wrkactNo",text:"工序工分表编号",editor:{allowBlank:true},hidden:true},{dataIndex:"workProcessCode",text:"工序编码",editor:{allowBlank:false}},{dataIndex:"workProcessName",text:"工序名称"},{dataIndex:"description",text:"描述"},{dataIndex:"workValue",text:"工分值",editor:{allowBlank:false}},{dataIndex:"orderNo",text:"序号",editor:{allowBlank:false},hidden:true},{dataIndex:"workGroupCode",text:"作业组别",xtype:"bllookupedit",estore:a,gstore:a,displaymember:"workGroupName",valuemember:"workGroupCode",},{dataIndex:"unitNo",text:"单位编号",editor:{allowBlank:false}},{dataIndex:"standard",text:"标准工分定额",editor:{allowBlank:true}},{dataIndex:"funcRelation",text:"函数关系",editor:{allowBlank:true}},{dataIndex:"aliasName",text:"别名",editor:{allowBlank:true}},],gridPrimaryKey:"lineId",gridTitle:"工序工分表",gridModel:"Hc_pd.model.PdWrkactMainDtl",gridLoadUrl:Hc.pdsPath+"pd_wrkact_main_dtl/listAll.json",gridHasMark:false,gridHasCreator:false,gridHasModifier:false,gridHasAuditor:false,gridHasOrderNo:true,gridUnionKey:"wrkactNo,orderNo",grid1Columns:[{dataIndex:"lineId",text:"行id(主键)",editor:{allowBlank:false},hidden:true},{dataIndex:"wrkactNo",text:"工序工分表编号",editor:{allowBlank:true},hidden:true},{dataIndex:"materialNo",text:"对应成品编号",editor:{allowBlank:false}},{dataIndex:"materialName",text:"对应成品名称"},{dataIndex:"styleNo",text:"款号"},{dataIndex:"modelNo",text:"型体"},],grid1Model:"Hc_pd.model.PdWrkactMainRel",grid1PrimaryKey:"lineId",grid1Title:"对应产品",grid1HasMark:false,grid1HasCreator:false,grid1HasModifier:false,grid1HasAuditor:false,grid1HasOrderNo:false,grid1UnionKey:"materialNo",grid1LoadUrl:Hc.pdsPath+"pd_wrkact_main_rel/listAll.json"});b.callParent()}});
Ext.define("Hc_pd.view.pdwrkactmaindtl.PdWrkactMainDtlController",{extend:"Hc_Common.view.BaseBillDetailPageController",alias:"controller.pdwrkactmaindtl",setCommonToobar:function(a){if(!a||a.length<1){return}a.btnSearch.setVisible(false);a.btnExport.setVisible(false);a.btnPrint.setVisible(true);a.btnOther.setVisible(false);a.btnSave.setVisible(false);a.btnPrint.setText("添加半产品");a.btnPrint.setDisabled(false);a.btnOther1.setVisible(true);a.btnOther1.setText("上移");a.btnOther1.setDisabled(false);a.btnOther2.setVisible(true);a.btnOther2.setText("下移");a.btnOther2.setDisabled(false);a.btnOther3.setVisible(true);a.btnOther3.setText("工序选择");a.btnOther3.setDisabled(false);a.btnOther4.setVisible(true);a.btnOther4.setText("复制");a.btnOther4.setDisabled(false);a.btnOther5.setVisible(true);a.btnOther5.setText("工序移动");a.btnOther5.setDisabled(false);for(var b=3;b<7;b++){var c=a["commontoolsp"+b];if(c){c.setVisible(false)}}},gridSelectionChange:function(b,c){this.callParent(arguments);var d=this.getObjList();var a=d.commonbill.store.getAt(0).get("billStatus");if(a>=40){d.btnPrint.setDisabled(true)}},onBtnOther1:function(c){var i=this;this.callParent(arguments);objs=i.getObjList();if(!objs){return}var j=objs.mastergrid.store;var d=objs.mastergrid.getSelection();var f=j.getData();if(f.length<=1){Hc.alert("至少要有2条数据才能移动");return}if(d.length>1){Hc.alert("只能选择一行进行移动!");return}if(d.length<1){Hc.alert("没有选择移动的数据!");return}var e=d[0];var h=e.get("lineId");var b=j.findExact("lineId",h);var a=b-1;if(b==0){return}var g=j.getAt(a);i.onDataMove(i,e,g)},onBtnOther2:function(c){var i=this;this.callParent(arguments);var e=i.getObjList();if(!e){return}var j=e.mastergrid.store;var d=e.mastergrid.getSelection();var g=j.getData();if(g.length<=1){Hc.alert("至少要有2条数据才能移动");return}if(d.length>1){Hc.alert("只能选择一行进行移动!");return}if(d.length<1){Hc.alert("没有选择移动的数据!");return}var f=d[0];var h=f.get("lineId");var b=j.findExact("lineId",h);var a=b+1;if(b+1>=g.length){return}var k=j.getAt(a);i.onDataMove(i,f,k)},onBtnOther5:function(a){var i=this;this.callParent(arguments);var c=i.getObjList();if(!c){return}var g=i.workObject;if(g.viewModelKey!="mastergrid"){return}var j=c.mastergrid.store;var b=c.mastergrid.getSelection();var e=j.getData();if(e.length<=1){Hc.alert("至少要有2条数据才能移动");return}if(b.length>1){Hc.alert("只能选择一行进行移动!");return}if(b.length<1){Hc.alert("没有选择移动的数据!");return}var d=b[0];var f=d.get("workProcessCode");var k=d.get("orderNo");var h=Ext.create("Ext.window.Window",{title:"请输入要移动的目标序号:",height:150,width:400,layout:"form",modal:true,resizable:false,items:[{xtype:"form",layout:{type:"column",columns:1},items:[{columnWidth:1,xtype:"label",text:"请输入工序编码为["+f+"]序号为["+k+"]的目标序号:"},{columnWidth:0.98,xtype:"textfield",hideLabel:true,id:"orderNo",name:"orderNo",reference:"orderNo",allowBlank:false}],}],buttons:[{text:"确定",handler:function(l){if(!(l.up("window").down("form").isValid())){return}var m=l.up("window").down("form").getComponent("orderNo").getValue();i.onMoveOrderNo(m,i,h)}},{text:"取消",handler:function(){h.close()}}],listeners:{show:function(m,l){}}});h.show()},onMoveOrderNo:function(n,k,j){var k=this;var f=k.getObjList();if(!f){return}var i=k.workObject;if(i.viewModelKey!="mastergrid"){return}var m=f.mastergrid.store;var c=f.mastergrid.getSelection();var g=m.getData();if(g.length<=1){Hc.alert("至少要有2条数据才能移动");return}if(c.length>1){Hc.alert("只能选择一行进行移动!");return}if(c.length<1){Hc.alert("没有选择移动的数据!");return}var e=c[0];var h=e.get("orderNo");var l=parseInt(n);var a=m.findExact("orderNo",h);var d=m.findExact("orderNo",l);if(d<0){Hc.alert("没有找到对应序号的数据,请输入正确的序号");return}var b=m.getAt(d);k.onDataMove(k,e,b);j.close()},onDataMove:function(u,f,r){var k=f.get("workProcessCode");var j=f.get("workProcessName");var n=f.get("description");var v=f.get("workValue");var b=f.get("workGroupCode");var s=f.get("unitNo");var d=f.get("orderNo");var q=f.get("standard");var h=f.get("funcRelation");var w=f.get("aliasName");var m=r.get("workProcessCode");var l=r.get("workProcessName");var p=r.get("description");var c=r.get("workValue");var g=r.get("workGroupCode");var t=r.get("unitNo");var e=r.get("orderNo");var i=r.get("standard");var o=r.get("funcRelation");var a=r.get("aliasName");f.set("workProcessCode",m);r.set("workProcessCode",k);f.set("workProcessName",l);r.set("workProcessName",j);f.set("description",p);r.set("description",n);f.set("workValue",c);r.set("workValue",v);f.set("workGroupCode",g);r.set("workGroupCode",b);f.set("unitNo",t);r.set("unitNo",s);f.set("standard",i);r.set("standard",q);f.set("funcRelation",o);r.set("funcRelation",h);f.set("aliasName",a);r.set("aliasName",w);if(!f.get("toWorkGroupCode")){f.set("toWorkGroupCode",f.get("toWorkGroupCode"));r.set("toWorkGroupCode",r.get("toWorkGroupCode"))}},onBtnOther4:function(c){var d=this;this.callParent(arguments);var e=d.getObjList();if(!e){return}var b=e.mastergrid.store;var a=b.getData();if(a.length>0){Hc.alert("请删除原有工序并保存后在再行复制");return}d.showWorkProcessChooseDialog("copy")},onBtnPrintClick:function(c){var d=this;this.callParent(arguments);var e=d.getObjList();if(!e){return}var b=e.mastergrid.store;var a=b.getData();if(a.length>0){}d.showWorkProcessChooseDialog("addMaterial")},onBtnOther3:function(a){var b=this;if(!(b.getObj("commonbill").isValid())){return}b.showWorkProcessChooseDialog("select")},showWorkProcessChooseDialog:function(a){var b=this;if(a=="select"){var c={xtype:"pdworkprocesschoose",userRight:b.view.userRight,moduleRight:b.view.moduleRight,userCode:b.view.userCode,userName:b.view.userName};c.width=Ext.getBody().getWidth()*0.8;c.height=Ext.getBody().getHeight()*0.8;b.showInWin(c,{winName:"pdworkprocesschoose",title:"工序选择",showBbar:true})}if(a=="copy"){var c={xtype:"pdwrkactmaindialog",userRight:b.view.userRight,moduleRight:b.view.moduleRight,userCode:b.view.userCode,userName:b.view.userName};c.width=Ext.getBody().getWidth()*0.8;c.height=Ext.getBody().getHeight()*0.8;b.showInWin(c,{winName:"pdwrkactmaindialog",title:"复制",showBbar:true})}if(a=="addMaterial"){var c={xtype:"pdwrkactmainrel",userRight:b.view.userRight,moduleRight:b.view.moduleRight,userCode:b.view.userCode,userName:b.view.userName};c.width=Ext.getBody().getWidth()*0.8;c.height=Ext.getBody().getHeight()*0.8;b.showInWin(c,{winName:"pdwrkactmainrel",title:"添加半成品",showBbar:true})}},onWinConfirmClick:function(g){var v=this;var b=v.getObjList();var e=g.up("window");var c=e.down("form");var w=c.getValues();if(!c.isValid()){return}if(e.winName=="pdworkprocesschoose"){v.workObject=b.mastergrid;var h=v.workObject.getStore();var j=h.count();var a=Ext.getCmp("workProcessChooseGrid1").getStore();for(var q=0;q<a.getCount();q++){var d=h.getModel();var s=a.getAt(q);var t=j;var f=d.create({_flag:"A"});f.set("billNo",v.view.billNo);if(v.workObject.hasOrderNo){var k=v.workObject.store;var r=(k.max("orderNo")||0)+1;f.set("orderNo",r)}f.set("workProcessCode",s.get("workProcessCode"));f.set("workProcessName",s.get("workProcessName"));f.set("description",s.get("description"));f.set("workValue",s.get("workValue"));f.set("workGroupCode",s.get("workGroupCode"));f.set("unitNo",s.get("units"));f.set("standard",s.get("workValue"));h.add(f);v.workObject.getSelectionModel().select(j);j=j+1}g.up("window").close()}if(e.winName=="pdwrkactmaindialog"){var n=Ext.getCmp("PdWrkactMainDialogGrid").getSelection();if(n.length>1){return}var u=n[0];var m=u.get("wrkactNo");v.workObject=b.mastergrid;Ext.Ajax.request({url:Hc.pdsPath+"pd_wrkact_main/getDtlRel.json",params:{wrkactNo:m},success:function(x,y){var i=JSON.parse(x.responseText);var z=b.mastergrid.store;var A=b.grid1.store;Ext.each(i.listdtl,function(B){var D=z.getModel();var C=D.create({_flag:"A"});C.set("workProcessCode",B.workProcessCode);C.set("workProcessName",B.workProcessName);C.set("description",B.description);C.set("workValue",B.workValue);C.set("orderNo",B.orderNo);C.set("workGroupCode",B.workGroupCode);C.set("unitNo",B.unitNo);C.set("standard",B.standard);C.set("funcRelation",B.funcRelation);C.set("aliasName",B.aliasName);z.add(C)});Ext.each(i.listrel,function(B){var D=A.getModel();var C=D.create({_flag:"A"});C.set("materialNo",B.materialNo);A.add(C)});g.up("window").close()}})}if(e.winName=="pdwrkactmainrel"){v.workObject=b.grid1;var h=v.workObject.getStore();var j=h.count();var p=Ext.getCmp("PdWrkactMainRelGrid").getSelection();if(p.length<=0){return}var l="";var o="";for(var q=0;q<p.length;q++){if(q==0){l=p[q].get("styleNo");o=p[q].get("modelNo")}else{if(p[q].get("styleNo")!=l||p[q].get("modelNo")){Hc.alert("请选择相同款号、型体的物料");return}else{l=p[q].get("styleNo");o=p[q].get("modelNo")}}}for(var q=0;q<p.length;q++){var d=h.getModel();var t=j;var f=d.create({_flag:"A"});f.set("billNo",v.view.billNo);f.set("wrkactNo",p[q].get("wrkactNo"));f.set("materialNo",p[q].get("materialNo"));f.set("styleNo",p[q].get("styleNo"));f.set("modelNo",p[q].get("modelNo"));h.add(f);v.workObject.getSelectionModel().select(j);j=j+1}g.up("window").close()}},checkKeyValue:function(h){var g=this;g.callParent(arguments);var b=h.record;if(h.field="workProcessCode"){var c=b.get("workProcessCode");if(h.value!=h.originalValue){Hc.callServer({url:Hc.pdsPath+"pd_work_process/list.json",params:{workProcessCode:c},success:function(k){var j=Ext.decode(k.responseText);var n=j.list.length;if(n>0){var e=j.list[0].workProcessName;var m=j.list[0].workCateCode;var i=j.list[0].units;var o=j.list[0].workValue;var l=j.list[0].description;if(e){b.set("workProcessName",e);b.set("workCateCode",m);b.set("units",i);b.set("workValue",o);b.set("description",l)}}else{b.set("workProcessName","");b.set("workCateCode","");b.set("description","")}}})}}if(h.field="materialNo"){var f=b.get("materialNo");var d=g.workObject;var a=d.store.getData();if(h.value!=h.originalValue){Hc.callServer({url:Hc.mdmPath+"bas_material/list.json",params:{materialNo:f},success:function(k){var j=Ext.decode(k.responseText);var m=j.list.length;if(m>0){var o=j.list[0].materialName;var e=j.list[0].styleNo;var n=j.list[0].modelNo;if(o){for(var l=0;l<a.length;l++){}b.set("materialName",o);b.set("styleNo",e);b.set("modelNo",n)}}else{b.set("materialNo","");b.set("materialName","");b.set("styleNo","");b.set("modelNo","")}}})}}},beforeSave:function(g){this.callParent(arguments);var f=this;if(f.lookupReference("modelNo")){var c=f.getObjList();f.workObject=c.grid1;var e=f.workObject.store;var b=e.getData();var a=null;var h=null;if(b.length>0){for(var d=0;d<b.length;d++){if(d==0){a=b.items[d].get("styleNo");h=b.items[d].get("modelNo")}else{if(b.items[d].get("styleNo")!=a||b.items[d].get("modelNo")){Hc.alert("存在不相同款号、型体的物料，请重新编辑");return false}else{a=b.items[d].get("styleNo");h=b.items[d].get("modelNo")}}}var a=b.items[0].get("styleNo");var h=b.items[0].get("modelNo");f.lookupReference("modelNo").setValue(h)}}return true},setStatusText:function(b){this.callParent(arguments);var c=this;var d=c.getObjList();var a=b.get("billStatus");if(a==40){d.btnBillAudit.setText("反审核");d.btnBillAudit.setVisible(true);d.btnBillAudit.setDisabled(false);d.btnOther1.setDisabled(true);d.btnOther2.setDisabled(true);d.btnOther3.setDisabled(true);d.btnOther4.setDisabled(true);d.btnOther5.setDisabled(true);d.btnPrint.setDisabled(true);d.btnAdd.setDisabled(true)}else{if(a<40){d.btnBillAudit.setText("审核");d.btnOther1.setDisabled(false);d.btnOther2.setDisabled(false);d.btnOther3.setDisabled(false);d.btnOther4.setDisabled(false);d.btnOther5.setDisabled(false);d.btnPrint.setDisabled(false);d.btnAdd.setDisabled(false)}else{d.btnBillAudit.setText("释放");d.btnOther1.setDisabled(true);d.btnOther2.setDisabled(true);d.btnOther3.setDisabled(true);d.btnOther4.setDisabled(true);d.btnOther5.setDisabled(true);d.btnPrint.setDisabled(true);d.btnAdd.setDisabled(true)}}},});
Ext.define("Hc_pd.view.pdwrkactmaindtl.PdWrkactMainDtlModel",{extend:"Hc_Common.view.BaseBillDetailPageModel",alias:"viewmodel.pdwrkactmaindtl"});
Ext.define("Hc_pd.view.pdwrkactmainrel.PdWrkactMainRel",{extend:"Hc_Common.view.BaseSimplePage",alias:"widget.pdwrkactmainrel",controller:"pdwrkactmainrel",viewModel:{type:"pdwrkactmainrel"},initComponent:function(){var a=this;Ext.apply(a,{searchItems:[{xtype:"textfield",fieldLabel:"物料编号",name:"materialNo"},{xtype:"textfield",fieldLabel:"款号",name:"styleNo"},{xtype:"textfield",fieldLabel:"型体",name:"modelNo"}],gridColumns:[{dataIndex:"lineId",text:"行id(主键)",hidden:true},{dataIndex:"materialNo",text:"物料编号"},{dataIndex:"materialName",text:"物料名称"},{dataIndex:"modelNo",text:"型体"},{dataIndex:"styleNo",text:"款号"},],gridHasMark:false,gridHasCreator:false,gridHasModifier:false,gridHasAuditor:false,gridModel:"Hc_pd.model.PdWrkactMainRel",gridLoadUrl:Hc.mdmPath+"bas_material/list.json?materialType=0",});Ext.apply(a.grid,{id:"PdWrkactMainRelGrid"});a.callParent()}});
Ext.define("Hc_pd.view.pdwrkactmainrel.PdWrkactMainRelController",{extend:"Hc_Common.view.BaseSimplePageController",alias:"controller.pdwrkactmainrel",init:function(){var d=this;d.callParent();var a=d.lookupReference("commontoolbar").items;for(var b=0;b<a.length;b++){var c=a.getAt(b);c.setVisible(c.itemId=="btnSearch")}}});
Ext.define("Hc_pd.view.pdwrkactmainrel.PdWrkactMainRelModel",{extend:"Hc_Common.view.BaseSimplePageModel",alias:"viewmodel.pdwrkactmainrel"});
